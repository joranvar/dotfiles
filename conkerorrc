load_paths.unshift("chrome://conkeror-contrib/content/");

/// Session save and restore
require("session.js");

/// Show a tweaked modeline
require("mode-line.js");
require("mode-line-buttons.js");
//mode_line_add_buttons(standard_mode_line_buttons, true);
add_hook("mode_line_hook", mode_line_adder(buffer_count_widget), true);
add_hook("mode_line_hook", mode_line_adder(loading_count_widget), true);
remove_hook("mode_line_hook", mode_line_adder(clock_widget));
require("favicon");
add_hook("mode_line_hook", mode_line_adder(buffer_icon_widget), true);

/// Enable history browsing
define_browser_object_class(
    "history-url", null,
    function (I, prompt) {
        check_buffer (I.buffer, content_buffer);
        var result = yield I.buffer.window.minibuffer.read_url(
            $prompt = prompt,  $use_webjumps = false, $use_history = true, $use_bookmarks = false);
        yield co_return (result);
    });

interactive("find-url-from-history",
            "Find a page from history in the current buffer",
            "find-url",
            $browser_object = browser_object_history_url);

interactive("find-url-from-history-new-buffer",
            "Find a page from history in the current buffer",
            "find-url-new-buffer",
            $browser_object = browser_object_history_url);

define_key(content_buffer_normal_keymap, "h", "find-url-from-history-new-buffer");
define_key(content_buffer_normal_keymap, "H", "find-url-from-history");

/// Send Firefox-compatible user agent string to some sites
require("user-agent-policy");

user_agent_policy.define_policy("whatsapp",
    "Mozilla/5.0 (X11; Linux x86_64; rv:53.0) Gecko/20100101 Firefox/53.0",
    "web.whatsapp.com");
user_agent_policy.define_policy("default",
    "Mozilla/5.0 (X11; Linux x86_64; rv:53.0) Gecko/20100101 Firefox/53.0",
    "teamsatellite.slack.com");
user_agent_policy.define_policy("pivotal",
    "Mozilla/5.0 (X11; Linux x86_64; rv:53.0) Gecko/20100101 Firefox/53.0",
    "www.pivotaltracker.com");

/// xkcd
xkcd_add_title = true;
